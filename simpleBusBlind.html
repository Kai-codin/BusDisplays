<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bus Display</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
      color: #ffaa00;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .route {
      font-size: 20vh;
      font-weight: bold;
      margin-top: -20vh;
    }

    .destination {
      font-size: 10vh;
      margin-top: 2vh;
      text-align: center;
    }

    .via {
      font-size: 6vh;
      margin-top: 2vh;
      white-space: nowrap;
      overflow: hidden;
      position: relative;
      width: calc(100vw - 20px);
      text-align: center;
    }

    .via span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll 20s linear infinite;
    }

    @keyframes scroll {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-100%);
      }
    }

    #menuBtn,
    #toggleBtn {
      position: absolute;
      top: 10px;
      background: #222;
      color: #ffaa00;
      border: 1px solid #555;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 4px;
    }

    #menuBtn {
      right: 10px;
    }

    #toggleBtn {
      left: 10px;
    }

    /* Overlay form */
    #menuOverlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    #menuOverlay h2,
    #menuOverlay h3 {
      color: #ffaa00;
      margin: 10px 0;
    }

    #menuOverlay input,
    #menuOverlay select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #555;
      border-radius: 4px;
      background: #222;
      color: #ffaa00;
    }

    #menuOverlay button {
      padding: 10px 20px;
      margin: 10px 5px 0 0;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #ffaa00;
      color: #000;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

    hr {
      border: none;
      border-top: 1px solid #444;
      margin: 16px 0;
    }

    #fsBtn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: #222;
      color: #ffaa00;
      border: 1px solid #555;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <button id="toggleBtn">Switch: Outbound</button>
  <button id="menuBtn">Menu</button>
  <button id="fsBtn">⛶ Fullscreen</button>

  <div class="route" id="route">22</div>
  <div class="destination" id="destination">PICCADILLY</div>
  <div class="via"><span id="via">VIA OXFORD STREET & REGENT STREET</span></div>

  <!-- Overlay Menu -->
  <div id="menuOverlay">
    <h2>Saved Routes</h2>
    <select id="routeSelect"></select>
    <button id="loadBtn">Load Selected</button>
    <hr />

    <div class="row">
      <div>
        <h3>Outbound</h3>
        <label>Route:</label>
        <input type="text" id="outRoute" placeholder="Route number">
        <label>Destination:</label>
        <input type="text" id="outDestination" placeholder="Destination">
        <label>Via:</label>
        <input type="text" id="outVia" placeholder="Via text">
      </div>

      <div>
        <h3>Inbound</h3>
        <label>Route:</label>
        <input type="text" id="inRoute" placeholder="Route number">
        <label>Destination:</label>
        <input type="text" id="inDestination" placeholder="Destination">
        <label>Via:</label>
        <input type="text" id="inVia" placeholder="Via text">
      </div>
    </div>

    <hr />
    <button id="applyBtn">Apply</button>
    <button id="saveBtn">Save as New</button>
    <button id="closeBtn">Close</button>
  </div>

  <script>
    const fsBtn = document.getElementById("fsBtn");

    // Keys
    const LIST_KEY = "busRoutesList"; // Array of {label, data}
    const ACTIVE_KEY = "busActiveIndex"; // Number (index into list)

    // UI refs
    const routeEl = document.getElementById("route");
    const destinationEl = document.getElementById("destination");
    const viaEl = document.getElementById("via");

    const menuOverlay = document.getElementById("menuOverlay");
    const routeSelect = document.getElementById("routeSelect");
    const loadBtn = document.getElementById("loadBtn");
    const applyBtn = document.getElementById("applyBtn");
    const saveBtn = document.getElementById("saveBtn");
    const closeBtn = document.getElementById("closeBtn");
    const menuBtn = document.getElementById("menuBtn");
    const toggleBtn = document.getElementById("toggleBtn");

    let currentDirection = "outbound"; // default

    // Helpers: storage
    const getList = () => JSON.parse(localStorage.getItem(LIST_KEY) || "[]");
    const setList = (arr) => localStorage.setItem(LIST_KEY, JSON.stringify(arr));
    const getActiveIndex = () => {
      const v = localStorage.getItem(ACTIVE_KEY);
      const n = v === null ? -1 : parseInt(v, 10);
      return Number.isFinite(n) ? n : -1;
    };
    const setActiveIndex = (i) => localStorage.setItem(ACTIVE_KEY, String(i));

    // Current active preset data (from list/activeIndex), or null
    function getActiveRouteData() {
      const list = getList();
      const idx = getActiveIndex();
      if (idx >= 0 && list[idx]) return list[idx].data;
      return null;
    }

    // UI helpers
    function updateDisplay(data) {
      if (!data) return;
      routeEl.textContent = data.route || "";
      destinationEl.textContent = data.destination || "";
      viaEl.textContent = data.via || "";
    }

    function getFormData() {
      return {
        outbound: {
          route: document.getElementById("outRoute").value,
          destination: document.getElementById("outDestination").value,
          via: document.getElementById("outVia").value,
        },
        inbound: {
          route: document.getElementById("inRoute").value,
          destination: document.getElementById("inDestination").value,
          via: document.getElementById("inVia").value,
        },
      };
    }

    function setFormData(data) {
      if (!data) return;
      document.getElementById("outRoute").value = data.outbound?.route || "";
      document.getElementById("outDestination").value = data.outbound?.destination || "";
      document.getElementById("outVia").value = data.outbound?.via || "";
      document.getElementById("inRoute").value = data.inbound?.route || "";
      document.getElementById("inDestination").value = data.inbound?.destination || "";
      document.getElementById("inVia").value = data.inbound?.via || "";
    }

    // Populate dropdown and keep selection in sync with ACTIVE_KEY
    function populateRouteDropdown() {
      const list = getList();
      const active = getActiveIndex();

      routeSelect.innerHTML = "";
      if (list.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "No saved routes yet";
        routeSelect.appendChild(opt);
        routeSelect.disabled = true;
        loadBtn.disabled = true;
        return;
      }

      routeSelect.disabled = false;
      loadBtn.disabled = false;

      list.forEach((route, index) => {
        const opt = document.createElement("option");
        opt.value = index;
        opt.textContent = route.label || `Preset ${index + 1}`;
        routeSelect.appendChild(opt);
      });

      // Select active if valid, else 0
      const toSelect = (active >= 0 && active < list.length) ? active : 0;
      routeSelect.value = String(toSelect);
      if (toSelect !== active) setActiveIndex(toSelect);
    }

    // Apply currently active preset to display + form
    function syncActiveDisplayAndForm() {
      const activeData = getActiveRouteData();
      if (!activeData) return;

      // Update display for current direction
      updateDisplay(activeData[currentDirection]);

      // Keep form in sync so edits start from active preset
      setFormData(activeData);
    }

    // Buttons
    menuBtn.onclick = () => {
      populateRouteDropdown();
      syncActiveDisplayAndForm();
      menuOverlay.style.display = "block";
    };

    closeBtn.onclick = () => {
      menuOverlay.style.display = "none";
    };

    loadBtn.onclick = () => {
      const idx = parseInt(routeSelect.value, 10);
      if (Number.isFinite(idx)) {
        setActiveIndex(idx);
        syncActiveDisplayAndForm();
      }
    };

    applyBtn.onclick = () => {
      const data = getFormData();
      updateDisplay(data[currentDirection]);
    };

    saveBtn.onclick = () => {
      const data = getFormData();
      const label = (data.outbound.route || "").toString().trim() + " → " + (data.outbound.destination || "")
        .toString().trim();

      const list = getList();
      list.push({
        label,
        data
      });
      setList(list);

      // Make the newly saved one active
      const newIndex = list.length - 1;
      setActiveIndex(newIndex);

      populateRouteDropdown();
      routeSelect.value = String(newIndex);
      alert("Saved!");
    };

    // Toggle inbound/outbound — always use the ACTIVE preset
    toggleBtn.onclick = () => {
      currentDirection = currentDirection === "outbound" ? "inbound" : "outbound";
      toggleBtn.textContent = "Switch: " + (currentDirection === "outbound" ? "Outbound" : "Inbound");

      const activeData = getActiveRouteData();
      if (activeData) {
        updateDisplay(activeData[currentDirection]);
      }
    };

    // Initial load
    window.onload = () => {
      populateRouteDropdown();
      const activeData = getActiveRouteData();

      if (activeData) {
        updateDisplay(activeData[currentDirection]); // show active preset (outbound by default)
      } else {
        // nothing saved yet; leave the demo text
      }
    };

    fsBtn.onclick = () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          alert(`Error enabling fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    };
  </script>
</body>

</html>